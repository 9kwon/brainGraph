#' Calculate graph vulnerability
#'
#' This function calculates the \emph{vulnerability} of the vertices of a graph.
#' Here, vulnerability is considered to be the proportional drop in global
#' efficiency when a given node is removed from the graph. The vulnerability of
#' the graph is considered the maximum across all vertices.
#'
#' @param g The igraph graph object of interest
#' @export
#'
#' @return A vector of length equal to the number of vertices in \emph{g}
#'
#' @seealso \code{\link{graph.efficiency}}
#' @author Christopher G. Watson, \email{cgwatson@@bu.edu}
#' @references Latora V., Marchiori M. (2005) \emph{Variability and protection
#' of infrastructure networks}. Physical Review E, 71:015103.

vulnerability <- function(g) {
  Nv <- vcount(g)
  E.global <- g$E.global
  vuln <- vector(length=Nv)
  for (i in seq_len(Nv)) {
    g.tmp <- delete.vertices(g, i)
    E.global.tmp <- graph.efficiency(g.tmp, 'global')
    vuln[i] <- 1 - (E.global.tmp / E.global)
  }
  return(vuln)
}
